(function(c){function d(h,f){this.form=typeof h=="string"?document.getElementById(h):h;this.options={contentType:"application/x-www-form-urlencoded",fileType:[],beforeUpload:function(){return true},success:function(i){},failure:function(){}};for(var g in f){this.options[g]=f[g]}if(this.options.contentType=="multipart/form-data"){var e=typeof FormData=="function"?true:false;this._initFileTypeCheck();if(e){this.form.onsubmit=this._ajaxForm.bind(this)}else{this._iframeForm()}}else{this.form.onsubmit=this._sendAjax.bind(this)}}d.prototype={constructor:d,_getXMLHttpRequest:function(){var g;try{g=new XMLHttpRequest()}catch(f){try{g=new ActiveXObject("Msxml2.XMLHTTP")}catch(f){try{g=new ActiveXObject("Microsoft.XMLHTTP")}catch(f){throw new Error("你的浏览器过时了")}}}return g},_initFileTypeCheck:function(){var h=this.options.fileType;if(h.length>0){function f(){if(g){g()}var o=/\.[a-zA-z]+$/;var m=this.value.match(o);if(m!=null){var n=m[0].substring(1);var p=false;for(var l=0;l<h.length;l++){if(n.toLowerCase()==h[l].toLowerCase()){p=true;break}}if(!p){alert("file type must be "+h);b(this,f)}}else{alert("file type must be "+h);b(this,f)}}var g;var e=this.form.elements;for(var j=0;j<e.length;j++){var k=e[j];if(k.type=="file"){g=k.onchange;k.onchange=f}}}},_sendAjax:function(){var f=this._getXMLHttpRequest();f.onreadystatechange=function(){if(f.readyState==0){}else{if(f.readyState==1){}else{if(f.readyState==2){}else{if(f.readyState==3){}else{if(f.readyState==4){if(f.status==200){this.options.success(f.responseText)}else{this.options.failure()}}}}}}}.bind(this);var h=this.form.method;var e=this.form.action;var g="";if(h=="post"&&this.options.contentType=="application/json"){g=a(this.form,true)}else{if(h=="post"){g=a(this.form)}}if(h=="get"){g=a(this.form);e=e+"?"+g}f.open(h.toUpperCase(),e,true);if(this.options.beforeUpload()==false){}else{if(h=="post"){f.setRequestHeader("Content-Type",this.options.contentType+"; charset=UTF-8");f.send(g)}else{f.send(null)}}return false},_ajaxForm:function(){var f=new FormData(this.form);var e=this._getXMLHttpRequest();e.onreadystatechange=function(){if(e.readyState==0){}else{if(e.readyState==1){}else{if(e.readyState==2){}else{if(e.readyState==3){}else{if(e.readyState==4){if(e.status==200){this.options.success(e.responseText)}else{this.options.failure()}}}}}}}.bind(this);e.open("POST",this.form.action,true);if(this.options.beforeUpload()==false){}else{e.send(f)}return false},_iframeForm:function(){var f=document.createElement("iframe");f.name="upload_iframe";f.src="about:blank";f.style.display="none";document.getElementsByTagName("body")[0].appendChild(f);var e=this.options;setTimeout(function(){f.onload=function(){var g=f.contentDocument||f.document;if(g.body.innerHTML){e.success(g.body.innerHTML)}else{e.failure()}}},200);this.form.method="post";this.form.enctype=this.options.contentType;this.form.target=f.name;this.form.onsubmit=this.options.beforeUpload}};function b(e,h){e.onchange=null;e.value="";if(e.value){var g=document.createElement("form"),f=e.nextSibling,i=e.parentNode;g.appendChild(e);g.reset();i.insertBefore(e,f)}e.onchange=h}function a(l,k){var h=l.elements;var g=new Array();var f="{";for(var j=0;j<h.length;j++){var m=h[j];if(m.type=="radio"||m.type=="checkbox"){if(m.checked){if(k){f+='"'+m.name+'":"'+m.value+'",'}else{g.push(m.name+"="+m.value)}}}else{if(m.type!="submit"&&m.type!="button"&&m.type!="file"){if(k){f+='"'+m.name+'":"'+m.value.replace(/\"/g,'\\"')+'",'}else{g.push(m.name+"="+m.value)}}}}var e;if(k){f=f.substring(0,f.length-1);e=f+"}"}else{e=g.join("&")}return e}c.AjaxUpload=d})(window);